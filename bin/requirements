#!/usr/bin/bash

# Load printers
source <(curl -fsSL https://raw.githubusercontent.com/ildx/jarvis/main/bin/printers)

# Obs, bail out
set -e

# Teehee!
repoop() {
  sudo reboot
}

install_requirements() {
  warning "Setting up requirements..."

  # Create nix stuff
  sudo mkdir -p /System/Volumes/Data/opt/nix
  sudo chown "$(whoami)" /System/Volumes/Data/opt/nix
  sudo sh -c "echo 'nix System/Volumes/Data/opt/nix' >> /etc/synthetic.conf"

  export NIX_IGNORE_SYMLINK_STORE=1

  cat << EOF > "$HOME/.zprofile"
if [ -f "$HOME/.nix-profile/etc/profile.d/nix.sh" ]; then
  . "$HOME/.nix-profile/etc/profile.d/nix.sh"
  export NIX_IGNORE_SYMLINK_STORE=1
fi
EOF

  info "All done! Repoop."
  repoop
}
